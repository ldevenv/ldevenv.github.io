<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <meta name="googlebot" content="noindex, nofollow">
  
  <title>Procedural City in OpenGL</title>
  <meta content="" name="description">
  <meta content="" name="keywords">

  <!-- Favicons -->
  <link href="assets/img/favicon.png" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Raleway:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
  <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
  <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">

  <!-- Template Main CSS File -->
  <link href="assets/css/style.css" rel="stylesheet">

  <!-- =======================================================
  * Template Name: iPortfolio - v3.10.0
  * Template URL: https://bootstrapmade.com/iportfolio-bootstrap-portfolio-websites-template/
  * Author: BootstrapMade.com
  * License: https://bootstrapmade.com/license/
  ======================================================== -->
</head>

<body>

  <!-- ======= Mobile nav toggle button ======= -->
  <i class="bi bi-list mobile-nav-toggle d-xl-none"></i>

  <!-- ======= Header ======= -->
  <header id="header">
    <div class="d-flex flex-column">

      <div class="profile">
        <img src="assets/img/profilepic.png" alt="" class="img-fluid rounded-circle">
        <h1 class="text-light"><a href="index.html">Ramón Pérez Segarra</a></h1>
        <p class="text-light">Gameplay and AI developer.</p>
        <div class="social-links mt-3 text-center">
          <a href="https://twitter.com/Lonchadeveloper" target="_blank" class="twitter"><i class="bx bxl-twitter"></i></a>
          <a href="https://www.linkedin.com/in/ramon-perez-segarra/" target="_blank" class="linkedin"><i class="bx bxl-linkedin"></i></a>
          <a href="https://github.com/Lonchadepavo" target="_blank" class="github"><i class="bx bxl-github"></i></a>
        </div>
      </div>

      <nav id="navbar" class="nav-menu navbar">
        <ul>
          <li><a href="index.html#portfolio" class="nav-link scrollto"><i class="bx bx-book-content"></i> <span>Portfolio</span></a></li>
          <li><a href="index.html#about" class="nav-link scrollto"><i class="bx bx-user"></i> <span>About</span></a></li>
          <li><a href="index.html#resume" class="nav-link scrollto"><i class="bx bx-file-blank"></i> <span>Resume</span></a></li>
        </ul>
      </nav><!-- .nav-menu -->
    </div>
  </header><!-- End Header -->

  <main id="main">

    <!-- ======= Breadcrumbs ======= -->
    <section id="breadcrumbs" class="breadcrumbs">
      <div class="container">

        <div class="d-flex justify-content-between align-items-center">
          <h2>Procedural City in OpenGL</h2>
          <ol>
            <li><a href="index.html">Home</a></li>
            <li>Procedural City in OpenGL</li>
          </ol>
        </div>

      </div>
    </section><!-- End Breadcrumbs -->

    <!-- ======= Portfolio Details Section ======= -->
    <section id="portfolio-details" class="portfolio-details">
      <div class="container">

        <div class="row gy-4">
          <h1>A procedurally generated city with the focus set on learning how OpenGL works.</h1>
          <div class="col-lg-8">
            <div class="portfolio-details-slider swiper">
              <div class="swiper-wrapper align-items-center">
                <iframe width="920" height="518" src="https://www.youtube.com/embed/8kF4I0mliy0" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
              </div>
              <div class="swiper-pagination"></div>
            </div>
          </div>

          <div class="col-lg-4">
            <div class="portfolio-info">
              <h3>Project information</h3>
              <ul>
                <li><strong>Category</strong>: OpenGL Project</li>
                <li><strong>Project date</strong>: May, 2022</li>
                <li><strong>Made by</strong>: <a href="https://www.linkedin.com/in/ramon-perez-segarra/">Ramón Pérez Segarra</a> and <a href="https://www.linkedin.com/in/jes%C3%BAs-royo-carabal-ababba25a/">Jesús Royo Carabal.</a></li>
              </ul>
              <br>
              <h3>Description</h3>             
              <ul>
                <p>
                  In this project we built a simple procedural city divided by districts. This city works as a playground for testing our OpenGL skills and learn how to create lighting,
                  texturing, and programming specific shaders for different purposes.
                </p>
                <p>
                  The project also features a high level abstraction of the OpenGL library to ease the work with the library itself by creating classes that wrap around the base OpenGL features
                  such as textures, shaders, programs, etc.
                </p>
              </ul>
            </div>
          </div>
          
        </div>
        <div class="row gy-4">
          <div class="col-lg-8">
            <div class="portfolio-description">
              <h2>Project features</h2>
              <ul>
                <li>Simple procedurally generated city with districts.</li>
                <li>High level abstraction over OpenGL features (programs, shaders, textures, etc).</li>
                <li>Light creation and handling on runtime (point lights, directional lights, spot lights).</li>
                <li>Fog shader.</li>
                <li>Frustum culling optimizations.</li>
                <li>Working geometry shaders.</li>
                <li>Post-processes systems with Blur and Chromatic Aberration.</li>
                <li>A water shader.</li>
                <li>A built-in first person camera.</li>
              </ul>
            </div>
            <div class="portfolio-description">
              <h2>What I did</h2>
              <ul>
                <li>The procedural generation of the city.</li>
                <li>The OpenGL abstraction.</li>
                <li>Frustum culling.</li>
                <li>Geometry shaders.</li>
                <li>Worked with the frame buffers.</li>
                <li>Part of the lighting shaders (directional, point light and spot light).</li>
              </ul>
            </div>

            <hr>

            <div class="portfolio-description">
              <h2>How it was made</h2>
              
              <p></p>

              <h3>OpenGL abstraction</h3>
              <p>The project features a built in OpenGL abstraction to help in the creation of the procedural city and be able to develop bigger and better features for the Project
                for example, with the use of <strong>"Materials"</strong> made from OpenGL programs and shaders and with custom features that let the programmer define some behaviors don't have to worry
                about the implementation and left all the hard work to interfaces that must communicate your CPU logic with the GPU.
              </p>
              
              <h5><strong>How does it work</strong></h5>
              <p>All the abstraction is based on an academic graphics library that was created for the purpose of being reimplemented in order to learn how OpenGL works, this part of the project
                served perfectly as a solid base for the creation of our personal game engine built from scratch.
              </p>

              <p>
                The different parts that I had to reimplement were:
                <ul>
                  <li>Shader wrapper</li>
                  <li>Program wrapper</li>
                  <li>Buffer wrapper</li>
                  <li>Framebuffer wrapper</li>
                  <li>Texture wrapper</li>
                  <li>Rendering loop</li>
                </ul>
              </p>

              <h5><strong>Shader wrapper</strong></h5>
              <p>With the shader wrapper you are able to create a shader, define it's source code and compile it, leaving to the user the only task of creating the shader class itself.
              </p>

              <h5><strong>Program wrapper</strong></h5>
              <p>The program needs a group of shaders to create a link between them and it also has methods for the program's use and the uniform setting based on the different data types that you
                can send to a shader.
              </p>

              <h5><strong>Buffer wrapper</strong></h5>
              <p>The buffers work as a way to upload different kind of data to the GPU by using array or element buffers.
              </p>

              <h5><strong>Framebuffer</strong></h5>
              <p>One of the most interesting parts of the abstraction itself are the framebuffers, a wrapper that lets you create these "buffers" in order to be able to render directly to a texture
                and then use it to create things like post-processing effects, drawing shadows or even deferred rendering.
              </p>
              <p>In this case we are creating the buffers and dividing the rendering into a <strong>"Z Buffer"</strong> texture and the <strong>"Render Buffer"</strong> itself, after doing this we're creating simple post-processing effects such as blur and chromatic aberration.
              </p>

              <h5><strong>Texture wrapper</strong></h5>
              <p>The texture wrapper was built to let the programmer use the texture as a way of drawing something with the shaders or as a way to store information that the shaders could need. An example
                of the information storage using textures could be the shader receiving data about the fluctuations of a sound wave in order to create an equalizer that behaves differently depending on the sound wave that is receiving.
              </p>
              <hr>

              <h3>City's procedural generation</h3>
              <p>The procedural generation is a very simple one, as we wanted to create something that looked interesting by creating our city in an irregular grid of streets with different
                lengths and widths.
              </p>
              <p>The depth of the procedural generation wasn't deep enough but I managed to use the resources that I had to prevent the buildings from clipping and to try and create a visually interesting
                looking city. This was one of my first attempts to create a procedural generation.
              </p>

              <h5>How did the grid worked</h5>
              <p>The generation was divided in different layers, that we could arrange from the smallest to the biggest:</p>
              <ul>
                <li>Flat</li>
                <li>Building</li>
                <li>District</li>
              </ul>
              <hr>
              <br>
              <h5><strong>Flat</strong></h5>
              <p>A flat defines where must be a building, it has an specific size that can differ from the other flats in the grid (irregular grid)</p>
              <p>Another thing important when creating the flat is to define it's orientation, as this will be the base and parent of the building that will have in top, the easiest way
                to rate the building and give a little bit of variation is to apply the rotation when creating the flat itself because we are not tracking of detecting relations between buildings.
              </p>

              <p>The flat also has its own mesh and material, being able to change in case you wanted to have custom flats, even being different between them. In this example the flat
                used is just a cube scaled to look like a platform with a concrete texture.
              </p>

              <div>
                <img src="assets/img/portfolio/flat2.png" width="360" height="360">
                <p><i>Flat example.</i></p>
              </div>
              <br>
              <h5><strong>Building</strong></h5>
              <p>The building is just an entity with a material that has a specific albedo texture, specular map and mesh. All the buildings are pre-loaded before start generating the city.
              </p>

              <p>When placing the buildings, we are setting them as "derived" from the flat where they're placed in order to keep the flat's rotation, position and even the scale, as the buildings
                should be scaled based on the needs of the flat itself but trying to keep the size ratio and not deforming the meshes too much.
              </p>

              <div>
                <img src="assets/img/portfolio/building1.png" width="360" height="360">
                <img src="assets/img/portfolio/building2.png" width="360" height="360">
                <img src="assets/img/portfolio/building3.png" width="360" height="360">
                <img src="assets/img/portfolio/building4.png" width="360" height="360">
                <p><i>Building examples.</i></p>
              </div>

              <br>
              <h5><strong>District</strong></h5>
              <p>The district is the main "piece" of the city, a city is created by grouping multiple districts and are formed by flats, streets and buildings.</p>
              <p>You can create each district with different sizes and configurations as each one of them is built seperately from the rest and don't know each other, so the streets won't mess up
                with the twist that you're the one that must locate both districts aligned in order to create a sensation of a connected city.
              </p>

              <p>Distrcits have a very specific structure, with two big avenues that connect in the very center of the district in order to be able to easily connect different districts.
                They also feature a "square shaped street" that goes around all the district and finishes connecting everything and avoid having dead end streets.
              </p>
              
              <div>
                <img src="assets/img/portfolio/district_view.PNG">
                <p><i>District example with a red fog.</i></p>
              </div>

              <br>
              <h5><strong>Grid generation</strong></h5>
              <p>Now that I've explained the different segments of our city I'm explaining the whole process of generating it.</p>
              
              <p>The first step is to create a District by setting up its location, size, street width and avenue width, after that the district starts creating a series of structures called
                "TemporalStreet", which are the first approach to the streets of our district.
              </p>
              
              <br>
              <h5><strong>Circular and central avenues</strong></h5>
              <p>Every district has in common a series of streets, the ones called "Circular avenues" and "central avenues", these ones will be created by using temporal streets and the layout would look like this:</p>
              <div>
                <img src="assets/img/portfolio/temporal_district_layout.png" width="480" height="480">
                <p><i>District layout with temporal streets.</i></p>
              </div>

              <p>The purpose of the temporal streets is to mark off the boundings of the district and to have a way to communicate different districts,</p>
              
              <br>
              <h5><strong>Horizontal and vertical streets</strong></h5>
              <p>The next step is to create temporal streets to delimitate the flats of our district using the street width that we selected when we created the district. In this step we're going to
                make a distinction between horizontal and vertical streets and we will create the horizontal streets first in order to define the height of our future flats.
              </p>
              <div>
                <img src="assets/img/portfolio/horizontal_grid.png" width="480" height="480">
                <p><i>District layout with temporal horizontal streets.</i></p>
              </div>

              <p>This is the layout with all the horizontal streets, and now we're going to repeat the same operation but with vertical streets, generating the next layout:</p>
              <div>
                <img src="assets/img/portfolio/city_grid.png" width="480" height="480">
                <p><i>District layout with temporal horizontal streets.</i></p>
              </div>

              <p>And with this simple steps we have the layout for our districts with a fixed spaced for the flats where the buildings will be placed, but currently we only have a "data layout"
                and we need to convert it into a "physical" one by placing streets and flats.
              </p>

              <p>The main problem with this approach is that we want to connect our streets smoothly with the different intersections that we have, and currently we only have a bunch of horizontal and vertical
                streets, and if we place our streets over those "temporal streets" our streets will collide and have <strong>"z fighting"</strong> and very ugly intersections, so, we are going to segment the streets using
                the intersections between the horizontal and vertical temporal streets and will create "physical" streets on runtime.
              </p>

              <br>
              <h5><strong>Street segmentation</strong></h5>
              <p>For the segmentation process first we have to sort our arrays of temporal streets as we want to iterate through them from the left to the right and from the top to the bottom.</p>
              <p>The segmentation process is very simple, we just need to check the intersections of the streets and have a control on where the street starts and of its size, and with that data we are ready
                to instantiate a street with wanted mesh.
              </p>

              <p>Its important to know which street are we calculating, as we will need to differentiate between streets and intersections, but that's the next step, first we want to make sure that
                we can create the separate street segments.
              </p>

              <p>To ease the process of segmentating the streets we are going to take advantage of the predictability of our grid by just calculating the intersections of two of our streets, the circular bottom
              and the circular left avenue as they also count as regular streets but wider.
              </p>

              <div>
                <img src="assets/img/portfolio/segmentation.gif" width="480" height="480">
                <p><i>District segmentation process.</i></p>
              </div>

              <p>As you can see the streets are being segmentd in order, first the horizontal and then the vertical one. You also may have noticed that the street is cut just before the intersection and that's 
                because we need those spots to place a intersection depending on the number of connecting streets in that point.
              </p>

              <p>The next step is to repeat the process for every street used the stored intersections and interpolating between them, and with that we achieve a full district ready to place flats and buildings.</p>
              <p>The positioning of the flats is made during the segmentation process, as it's the optimal moment to do it because you're checking the bounds of the intersecting streets and you can find the central
                point and size of the flat easily.
              </p>

              <br>
              <h5><strong>Building placement</strong></h5>
              <p>The building placement is the last thing we need to do and the process is very simple. First we need to arrange our buildings by size, with three or four different sizes. This is not a very accurte technique but it's easy and fast.
                After the sorted the buildings we can iterate through our flats, check it's bounds and then choose randomly a building that fits that size with a margin.
              </p>
            </div>
          </div>
        </div>

      </div>
    </section><!-- End Portfolio Details Section -->

  </main><!-- End #main -->

  <!-- ======= Footer ======= -->
  <footer id="footer">
    <div class="container">
      <div class="copyright">
        &copy; Copyright <strong><span>Ramón Pérez Segarra. All Rights Reserved</span></strong>
      </div>
      <div class="credits">
        <!-- All the links in the footer should remain intact. -->
        <!-- You can delete the links only if you purchased the pro version. -->
        <!-- Licensing information: https://bootstrapmade.com/license/ -->
        <!-- Purchase the pro version with working PHP/AJAX contact form: https://bootstrapmade.com/iportfolio-bootstrap-portfolio-websites-template/ -->
        Designed by <a href="https://bootstrapmade.com/">BootstrapMade</a>
      </div>
    </div>
  </footer><!-- End  Footer -->

  <a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

  <!-- Vendor JS Files -->
  <script src="assets/vendor/purecounter/purecounter_vanilla.js"></script>
  <script src="assets/vendor/aos/aos.js"></script>
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/glightbox/js/glightbox.min.js"></script>
  <script src="assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
  <script src="assets/vendor/swiper/swiper-bundle.min.js"></script>
  <script src="assets/vendor/typed.js/typed.min.js"></script>
  <script src="assets/vendor/waypoints/noframework.waypoints.js"></script>
  <script src="assets/vendor/php-email-form/validate.js"></script>

  <!-- Template Main JS File -->
  <script src="assets/js/main.js"></script>

</body>

</html>